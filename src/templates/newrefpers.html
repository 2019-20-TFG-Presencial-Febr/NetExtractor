<!DOCTYPE html>
<html lang="es">
<head>
	<title>Ububooknet</title>
	<meta charset="UTF-8">
	<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	<script src="{{ url_for('static', filename='js/orden.js') }}" type="text/javascript"></script>
	<script type="text/javascript">
		function sendForm(){
			var id = document.getElementById("idpers");
			var ref = document.getElementById("refpers");
			if(id.value.length == 0){
				alert("Introduzca una ID")
			}
			else{
				if(ref.value.length == 0){
					alert("Introduzca una referencia")
				} else {
					var divpers = document.getElementsByClassName("Personaje");
					var incluido = false;
		        	for(var i=0; divpers[i]; ++i){
		        		if(divpers[i].getAttribute("idpers")==id.value){
		        			incluido = true;
		        			var personaje = divpers[i];
		        			break;
		        		}
		        	}
		        	if(incluido){
		        		var noms = personaje.getElementsByClassName("ref");
		        		var union = id.value + ref.value;
		        		var aux = false;
		        		for(var i=0; noms[i]; ++i){
			        		if(noms[i].getAttribute("idnompers")==union){
			        			aux = true;
			        			break;
			        		}
			        	}
			        	if(aux){
			        		alert("La referencia ya existe en el personaje")
			        	} else {
			        		alert("Referencia añadida correctamente")
			        		document.getElementById("form-menu").submit();
			        	}
		        	} else {
		        		alert("No existe ningún personaje con la ID introducida")
		        	}
	        	}
        	}
		}
	</script>
</head>
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
<body>
	<header id="header">
		<div class="logo">
			<h1>Ububooknet</h1>
		</div>
		<div class="region"> 
			<h2>Añadir Referencia A Personaje</h2>
		</div>
		<div class="menu">
			<ul>
				<li><a href="{{ url_for('index') }}">Inicio</a></li>
				<li><a href="https://github.com/lca0037/GII18.0U-Ububooknet">Repositorio</a></li>
			</ul>
		</div>
	</header>
	<div id="workflow"><a href="{{ url_for('index') }}">CARGAR EPUB</a> > <a href="{{ url_for('dictaut') }}">DICCIONARIO de PERSONAJES</a> > <a href="{{ url_for('moddict') }}">MODIFICAR DICCIONARIO</a> > AÑADIR REFERENCIA a PERSONAJE</div>
	<div id="content">
		<div id="indice">
			<form action="" id="form-menu" method="post">
				<div class="txt1">Introduzca la id del personaje a añadir la referencia</div>
				<input type="text" id="idpers" name="txt txt-idpers" placeholder="Nombre Personaje">
				<div class="txt1">Introduzca la nueva referencia al personaje</div>
				<input type="text" id="refpers" name="txt txt-refpers" placeholder="Referencia Personaje">
				<input type="button" onclick="sendForm()" name="btn btn-newref" value="Añadir">
				<p>{{error}}</p>
			</form>
			<div id="form-mov">
				<input type="submit" name="btn btn-volver" onclick="window.location.href='{{ url_for('moddict') }}'" value="Volver">
			</div>
		</div>
		<div id="Personajes">
			<div class="Personaje Cabecera">
				<div class="IdPersonaje">
					ID Personaje
					<div class="arrow-up" onclick="ordenar('idrev')"></div>
					<div class="arrow-down" onclick="ordenar('id')"></div>
				</div>
				<div class="NomP">Referencias personaje</div>
				<div class="NumApar">
					Número Apariciones
					<div class="arrow-up" onclick="ordenar('aparev')"></div>
					<div class="arrow-down" onclick="ordenar('apa')"></div>
				</div>
			</div>
			{% for i in pers.keys() %}
			<div class="Personaje" idpers="{{ i }}">
				<div class="IdPersonaje">{{ i }}</div>
				<div class="NomP">
				{% for n in pers[i].getPersonaje().keys() %}
					<p class="ref" idnompers="{{ i }}{{ n }}">{{ n }}</p>
				{% endfor %}
				</div>
				{% if pers[i].getNumApariciones()[1] %}
					<div class="NumApar" parse="true">{{ pers[i].getNumApariciones()[0] }}</div>
				{% elif pers[i].getNumApariciones()[0] == 0 %}
					<div class="NumApar" parse="false">N/A</div>
				{% else%}
					<div class="NumApar" parse="false">{{ pers[i].getNumApariciones()[0] }}</div>
				{% endif %}
			</div>
			{% endfor %}
		</div>
	</div>
	<footer></footer>
</body>
</html>
