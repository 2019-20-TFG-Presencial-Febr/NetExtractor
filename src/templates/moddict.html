<!DOCTYPE html>
<html lang="es">
<head>
	<title>Ububooknet</title>
	<meta charset="UTF-8">
</head>
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
<style type="text/css">
div#loading {
    width: 200px;
    height: 200px;
    display: none;
    background: url(/static/img/loading.gif) no-repeat;
    cursor: wait;
    }
</style>
<body>
	<header id="header">
		<div class="logo">
			<h1>Ububooknet</h1>
		</div>
		<div class="region"> 
			<h2>Modificar Diccionario</h2>
		</div>
		<div class="menu">
			<ul>
				<li><a href="{{ url_for('index') }}">Inicio</a></li>
				<li><a href="https://github.com/lca0037/GII18.0U-Ububooknet">Repositorio</a></li>
			</ul>
		</div>
		<div class="workflow"><a href="{{ url_for('index') }}">CARGAR EPUB</a> > <a href="{{ url_for('dictaut') }}">DICCIONARIO de PERSONAJES</a> > <a href="#">MODIFICAR DICCIONARIO</a> > PARÁMETROS ADICIONALES > RED > INFORME</div>
	</header>
	<div id="loading"></div>
	<div id="content">
		<div id="indice">
			<form action="" id="form-menu" method="post">
				<input type="submit" id="npers" name="btn btn-newpers" value="Añadir Personaje">
				<input type="submit" id="dpers" name="btn btn-delpers" value="Eliminar Personaje">
				<input type="submit" id="jpers" name="btn btn-joinpers" value="Juntar Personajes">
				<input type="submit" id="nref" name="btn btn-newrefpers" value="Añadir Referencia">
				<input type="submit" id="dref" name="btn btn-delrefpers" value="Eliminar Referencia">
				<input type="submit" id="mid" name="btn btn-modid" value="Modificar Id Personaje">
				<input type="submit" id="exp" name="btn btn-expdict" value="Exportar Diccionario">
			</form>
			<div id="pars">
				<input type="checkbox" id="pars-cbx" name="cbx cbx-pars">
				<label for="pars">Obtener Posiciones</label>
			</div>
			<div id="form-mov">
				<input type="button" class="volv" name="btn btn-volver" value="Volver" onclick="window.location.href='{{ url_for('dictaut') }}'">
				<input type="submit" class="sig" name="btn btn-parseo" title="Este proceso puede llevar unos minutos" onclick="loading()" value="Siguiente">
			</div>
		</div>
		<div id="Personajes">
			<div class="Personaje Cabecera">
				<div class="IdPersonaje">
					ID Personaje
					<div class="arrow-up" onclick="sortidrev()"></div>
					<div class="arrow-down" onclick="sortid()"></div>
				</div>
				<div class="NomP">Referencias personaje</div>
				<div class="NumApar">
					Número Apariciones
					<div class="arrow-up" onclick="sortaparev()"></div>
					<div class="arrow-down" onclick="sortapa()"></div>
				</div>
			</div>
			{% for i in pers.keys() %}
			<div class="Personaje">
				<div class="IdPersonaje">{{ i }}</div>
				<div class="NomP">
				{% for n in pers[i].getPersonaje().keys() %}
					<p class="ref">{{ n }}</p>
				{% endfor %}
				</div>
				{% if pers[i].getNumApariciones()[1] %}
					<div class="NumApar" parse="true">{{ pers[i].getNumApariciones()[0] }}</div>
				{% elif pers[i].getNumApariciones()[0] == 0 %}
					<div class="NumApar" parse="false">N/A</div>
				{% else%}
					<div class="NumApar" parse="false">{{ pers[i].getNumApariciones()[0] }}</div>
				{% endif %}
			</div>
			{% endfor %}
		</div>
	</div>
	<footer></footer>
	<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	<script type="text/javascript">
        function loading(){
        	var parsear = document.getElementById("pars-cbx").checked;
        	if(parsear){
        		alert('Primero se van a buscar las posiciones de los personajes, esto puede tardar unos minutos.');
        		$("#loading").show();
            	$("#content").hide();
            	$.ajax({
	          		type: "POST",
	          		contentType: "application/json;charset=utf-8",
	          		url: "/Modificar-Diccionario/",
	          		traditional: "true",
	          		data: JSON.stringify('parsear'),
	          		dataType: "json",
	          		success: function(response){
	          			console.log('Hola');
	          			location.reload();
             		 }
	        	});
        	} else {
        		window.location.href='{{ url_for('params') }}'
        	}     
        }

        function sortidrev(){
        	ordenar('idrev');
        }

        function sortid(){
        	ordenar('id');
        }

        function sortapa(){
        	ordenar('apa');
        }

        function sortaparev(){
        	ordenar('aparev');
        }

        function ordenar(tipo){
        	$.ajax({
	          type: "POST",
	          contentType: "application/json;charset=utf-8",
	          url: "/Modificar-Diccionario/",
	          traditional: "true",
	          data: JSON.stringify(tipo),
	          dataType: "json",
	          success: function(response){
              	$("#content #Personajes").replaceWith(response);
              }
	        });
        }

        window.onload = function lockcbx() {
        	var divapar = document.getElementsByClassName("NumApar");
        	for(var i=0; divapar[i]; ++i){
        		if(divapar[i].getAttribute("parse")=="false"){
        			document.getElementById("pars-cbx").checked = true;
        			document.getElementById("pars-cbx").disabled = true;
        		}
        	}
        }

    </script>
</body>
</html>
